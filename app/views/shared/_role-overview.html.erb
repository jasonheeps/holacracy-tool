<section class="role-overview-container <%= locals[:visibility_class] %>" id="<%= locals[:dataset_id] %>">
  <div class="role-info-container">
    <%= image_tag "holacracy_circle.svg",
      alt: "holacracy circle icon: a circle (the geometric shape) within another circle",
      class: "circle-icon icon--size-lg"
    %>

    <div class="role-overview-circles">
      <% @role.circles.each do |c| %>
        <p>
          <%= link_to circle_path(c), class: "text__link" do %>
            <%= c.acronym || c.title %>
          <% end %>
        </p>
      <% end %>
    </div>

    <%= image_tag "holacracy_employee.svg",
      alt: "soulie (employee) icon: simplified head with torso",
      class: "employee-icon icon--size-lg"
    %>

    <% if policy(RoleFilling.new(role: @role)).new? %>
      <%= link_to 'Rollenf체llung hinzuf체gen', new_role_filling_path  %>
    <% end %>
    
    <div class="role-overview-employees">
      <% if @role.ccms_and_non_ccms.empty? %>
        <% ll = @role.primary_circle.lead_link %>
        <p>
          Rolle unbesetzt
          <% if ll %>
            (Lead Link: <%= link_to ll.full_name, employee_path(ll), class: "text__link" %>)
          <% end %>
        </p>
      <% else %>
        <div class="stack-sm">
          <% @role.ccms.each do |e| %>
            <% rf = RoleFilling.find_by(role: @role, employee: e) %>

            <div class="d-flex align-items-center">
             <p>
               <%= link_to employee_path(e), class: "text__link" do %>
                 <%= "#{e.first_name} #{e.last_name}" %>
               <% end %>
             </p>
             <% if policy(rf).edit? %>
                <!-- TODO: why class 'edit-role'? want to use it here for role_filling. need more general class -->
                <%= link_to edit_role_filling_path(rf), class: 'edit-role' do %>
                  <i class="far fa-edit"></i>
                <% end %>
              <% end %>
              <% if policy(rf).destroy? %>
                <%= link_to role_filling_path(rf), method: :delete, data: { confirm: "Are you sure?" } do %>
                  <i class="far fa-trash-alt"></i>
                <% end %>
              <% end %>
            </div>

          <% end %>
        </div>

        <%# if @role.elected? %>
          <!-- <p><%#= "Gew채hlt bis: #{@role.new_election_date}" %></p> -->
        <%# end %>

        <% @role.non_ccms.each do |e| %>
          <p>
            <%= link_to employee_path(e), class: "text__link" do %>
              <%= "#{e.first_name} #{e.last_name}" %>
            <% end %>
          </p>
        <% end %>
      <% end %>

      <% @role.substitutes.each do |s| %>
        <p>
          <%= link_to employee_path(s), class: "text__link" do  %>
            <%= "(#{s.first_name} #{s.last_name})" %>
          <% end %>
        </p>
      <% end %>
    </div>
  </div>

  <div class="btn-container">
    <% if !@role.url || @role.url.blank? %>
      <%= link_to 'Rollenbeschreibung hinzuf체gen', edit_role_path(@role), class: 'btn-outline' %>
    <% else %>
      <%= link_to 'Zur Rollenbeschreibung', @role.url, class: 'btn-action', target: '_blank' %>
    <% end %>
  </div>
</section>
